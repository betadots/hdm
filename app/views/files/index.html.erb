<div class="row">
  <div class="col-6">
    <%= render "environments/select_environment" %>
  </div>
  <div class="col-6">
    <%= render "search" %>
  </div>
</div>

<div class="row mt-4">
  <div class="col-12">
    <h2>Search Results</h2>
    <p class="lead">
      <% if @files_and_values_by_hierarchy.any? %>
        Found key
        <code><%= @key.name %></code>
        in
        <b><%= t(".file", count: @files_and_values_by_hierarchy.values.map { |f| f.size }.sum) %></b>.
      <% else %>
        Could not find key
        <code><%= @key.name %></code>
        in any files.
      <% end %>
    </p>
  </div>
</div>

<div class="row mt-4">
  <div class="col-12">
    <% index = 0 %>
    <% @files_and_values_by_hierarchy.each do |hierarchy, files_and_values| %>
      <div class="accordion mb-2">
        <div class="card">
          <div class="card-body">
            <b><%= hierarchy.name %></b>
            <span class="badge badge-primary text-light"><%= hierarchy.backend %></span>
          </div>
        </div>
        <% files_and_values.each do |file, value| %>
          <% index += 1 %>
          <div class="card">
            <div class="card-header" id="path-<%= index %>">
              <h2 class="mb-0">
                <button class="btn btn-link btn-block text-left d-flex justify-content-between" type="button" data-toggle="collapse" data-target="#collapse-<%= index %>" aria-expanded="true" aria-controls="collapse-<%= index %>">
                  <span>
                    <b><%= file.path %></b>
                    <% if value&.encrypted? %>
                      <span class="text-danger">
                        <%= icon("lock-fill") %>
                      </span>
                    <% end %>
                  </span>
                </button>
              </h2>
            </div>
            <div id="collapse-<%= index %>" class="collapse" aria-labelledby="path-<%= index %>">
              <div class="card-body">
                <pre><%= value.value %></pre>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
